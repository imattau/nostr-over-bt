# Caddy configuration for Nostr-BT Relay
# Usually placed in /etc/caddy/conf.d/relay.conf

relay.yourdomain.com {
    # Reverse proxy to the Docker container binding on 127.0.0.1:8090
    reverse_proxy localhost:8090 {
        # Optional: Set a generous timeout for long-lived Nostr subscriptions
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }

    # Optional: Enable Gzip compression for JSON payloads
    encode gzip

    # Optional: Security headers
    header {
        # Allow standard Nostr client cross-origin requests
        Access-Control-Allow-Origin *
        # Standard security
        Strict-Transport-Security "max-age=31536000;"
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        Referrer-Policy no-referrer-when-downgrade
    }

    # Logging
    log {
        output file /var/log/caddy/relay_access.log
    }
}
